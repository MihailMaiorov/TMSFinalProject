<% if current_user.avatar.attached? %>
  <%= image_tag(current_user.avatar.variant(resize_and_pad: [200, 200])) %>
<% end %>

<h1 class="md-4"><%= @user.email %><h1>

<% if user_signed_in? %>

  <h2 class="lead my-3">Add reviews</h2>

  <%= form_with(model: [@user, @review]) do |form| %>
    <% if @user.errors.any? %>
      <div style="color: red">
        <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

        <ul>
          <% @user.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="md-3 row">
      <div class="col-sm-2 col-form-label">
        <%= form.label :comment %>
      </div>

      <div class="col-sm-10">
        <%= form.text_area :comment, placeholder: 'Text', class: 'form-control' %>
      </div>
    </div>

    <div class="md-3 row">
      <div class="col-sm-2 col-form-label">
        <%= form.label :rating %>
      </div>

      <div class="col-sm-10">
        <%= form.text_field :rating, placeholder: 'Rating', class: 'form-control' %>
      </div>
    </div>

    <div>
      <%= form.submit t('global.button.submit'), class: 'btn btn-primary' %>
    </div>

  <% end %>
<% end %>

<% @reviews.each do |review| %>
  <article class="card mt-3">
    <div class="card-body">
      <h4>Rating: <%= review.rating %><h4>

      <p class="my-2">
        Text: <%= review.comment %>
      </p>

      <p class="lead my-3">
          <time datetime="<%= review.formatted_create_at %>">
            <%= review.formatted_create_at %>
          <time>
      </p>

      <p class="my-2">
        Author: <%= User.find(review.user_id).email %>
      </p>

    </div>
  </article>

  <% if review.user_id == current_user.id %>
    <%= link_to t('global.button.edit'), edit_user_review_path(@user), class: 'btn btn-secondary'%> |
    <%= link_to t('global.button.delete'), user_review_path(@user), class: 'btn btn-danger',
      data: { turbo_method: :delete, turbo_confirm: t('dialog.you_sure') } %>
  <% end %>
<% end %>

<%= link_to t('global.button.back'), products_path %>